(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7923],{8918:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var l=n(95155),a=n(67909),i=n(12115);n(84876),n(70117);let s=(0,a.default)(()=>Promise.all([n.e(1563),n.e(2141),n.e(6333)]).then(n.bind(n,36333)),{loadableGenerated:{webpack:()=>[null]},ssr:!1});function r(e){let{value:t,onChange:n,placeholder:a="마크다운으로 작성하세요...",height:r=400,minHeight:o=300}=e,[c,d]=(0,i.useState)("live");return(0,l.jsxs)("div",{className:"markdown-editor-wrapper","data-color-mode":"dark",children:[(0,l.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>d("edit"),className:"px-3 py-1 text-sm rounded transition-colors ".concat("edit"===c?"bg-neutral-700 text-white":"bg-neutral-900 text-neutral-400 hover:text-white"),children:"편집"}),(0,l.jsx)("button",{type:"button",onClick:()=>d("live"),className:"px-3 py-1 text-sm rounded transition-colors ".concat("live"===c?"bg-neutral-700 text-white":"bg-neutral-900 text-neutral-400 hover:text-white"),children:"실시간"}),(0,l.jsx)("button",{type:"button",onClick:()=>d("preview"),className:"px-3 py-1 text-sm rounded transition-colors ".concat("preview"===c?"bg-neutral-700 text-white":"bg-neutral-900 text-neutral-400 hover:text-white"),children:"미리보기"})]}),(0,l.jsx)(s,{value:t,onChange:e=>n(e||""),preview:c,height:r,minHeight:o,textareaProps:{placeholder:a},style:{backgroundColor:"#171717",borderRadius:"0.5rem"},previewOptions:{style:{backgroundColor:"#171717"}}}),(0,l.jsx)("p",{className:"text-neutral-600 text-xs mt-2",children:"마크다운 문법을 지원합니다. # 제목, **굵게**, *기울임*, `코드`, [링크](url) 등"})]})}},10691:(e,t,n)=>{Promise.resolve().then(n.bind(n,96767))},37621:(e,t,n)=>{"use strict";n.d(t,{ZQ:()=>i,_H:()=>s,bG:()=>r,nq:()=>o});let l=n(95704).env.NEXT_PUBLIC_API_URL||"http://localhost:8080";async function a(e,t,n,a){let i={"Content-Type":"application/json"};a&&(i.Authorization="Bearer ".concat(a));let s={method:e,headers:i};n&&("POST"===e||"PUT"===e)&&(s.body=JSON.stringify(n));let r=await fetch("".concat(l).concat(t),s);if(!r.ok)throw Error((await r.json().catch(()=>({error:"HTTP ".concat(r.status)}))).error||"API request failed");let o=await r.text();if(o)return JSON.parse(o)}let i={login:e=>a("POST","/api/auth/login",e),register:e=>a("POST","/api/auth/register",e)},s={list:e=>{let t=new URLSearchParams;(null==e?void 0:e.status)&&t.append("status",e.status),(null==e?void 0:e.novel_type)&&t.append("novel_type",e.novel_type),(null==e?void 0:e.genre)&&t.append("genre",e.genre),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.offset)&&t.append("offset",e.offset.toString()),(null==e?void 0:e.include_drafts)&&t.append("include_drafts","true");let n=t.toString();return a("GET","/api/novels".concat(n?"?".concat(n):""))},getBySlug:e=>a("GET","/api/novels/".concat(e)),create:(e,t)=>a("POST","/api/novels",e,t),update:(e,t,n)=>a("PUT","/api/novels/".concat(e),t,n),delete:(e,t)=>a("DELETE","/api/novels/".concat(e),void 0,t),getGenres:()=>a("GET","/api/novels/genres"),getNovelTypes:()=>a("GET","/api/novels/types"),getRelations:e=>a("GET","/api/novels/".concat(e,"/relations")),addRelation:(e,t,n)=>a("POST","/api/novels/".concat(e,"/relations"),t,n),removeRelation:(e,t,n)=>a("DELETE","/api/novels/".concat(e,"/relations?related_slug=").concat(t),void 0,n),getChapters:e=>a("GET","/api/novels/".concat(e,"/chapters")),getChapter:(e,t)=>a("GET","/api/novels/".concat(e,"/chapters/").concat(t)),createChapter:(e,t,n)=>a("POST","/api/novels/".concat(e,"/chapters"),t,n),updateChapter:(e,t,n,l)=>a("PUT","/api/novels/".concat(e,"/chapters/").concat(t),n,l),deleteChapter:(e,t,n)=>a("DELETE","/api/novels/".concat(e,"/chapters/").concat(t),void 0,n)},r={list:e=>{let t=new URLSearchParams;(null==e?void 0:e.published)!==void 0&&t.append("published",e.published.toString()),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.offset)&&t.append("offset",e.offset.toString());let n=t.toString();return a("GET","/api/blog".concat(n?"?".concat(n):""))},getBySlug:e=>a("GET","/api/blog/".concat(e)),create:(e,t)=>a("POST","/api/blog",e,t),update:(e,t,n)=>a("PUT","/api/blog/".concat(e),t,n),delete:(e,t)=>a("DELETE","/api/blog/".concat(e),void 0,t)},o={list:e=>{let t=new URLSearchParams;(null==e?void 0:e.platform)&&t.append("platform",e.platform),(null==e?void 0:e.limit)&&t.append("limit",e.limit.toString()),(null==e?void 0:e.offset)&&t.append("offset",e.offset.toString());let n=t.toString();return a("GET","/api/apps".concat(n?"?".concat(n):""))},getBySlug:e=>a("GET","/api/apps/".concat(e)),getPlatforms:()=>a("GET","/api/apps/platforms"),getChannels:()=>a("GET","/api/apps/channels"),create:(e,t)=>a("POST","/api/apps",e,t),update:(e,t,n)=>a("PUT","/api/apps/".concat(e),t,n),delete:(e,t)=>a("DELETE","/api/apps/".concat(e),void 0,t)}},86237:(e,t,n)=>{"use strict";n.d(t,{A:()=>m});var l=n(95155),a=n(52619),i=n.n(a),s=n(20063),r=n(12115),o=n(13877),c=n(63090),d=n(70305),u=n(75802),p=n(67661),x=n(96778),h=n(74264);function m(e){let{children:t,title:n,backHref:a="/admin/dashboard",backLabel:m="← 대시보드",onBack:g}=e,v=(0,s.useRouter)(),[j,f]=(0,r.useState)(null),[y,b]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{let e=localStorage.getItem("admin_token"),t=localStorage.getItem("admin_user");if(!e||!t)return void v.push("/admin/login/");f(JSON.parse(t)),b(!1)},[v]),y)?(0,l.jsxs)(o.Container,{h:"100vh",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)(c.Loader,{color:"gray",size:"sm"}),(0,l.jsx)(d.Text,{size:"sm",c:"dimmed",ml:"sm",children:"로딩 중..."})]}):(0,l.jsx)(u.AppShell,{header:{height:0},padding:"md",children:(0,l.jsxs)(o.Container,{size:"sm",py:"xl",children:[(0,l.jsxs)("header",{style:{marginBottom:"var(--mantine-spacing-xl)"},children:[(0,l.jsxs)(p.Group,{justify:"space-between",mb:"lg",children:[g?(0,l.jsx)(x.Button,{variant:"subtle",color:"gray",size:"sm",onClick:g,children:m}):(0,l.jsx)(x.Button,{component:i(),href:a,variant:"subtle",color:"gray",size:"sm",children:m}),(0,l.jsxs)(p.Group,{gap:"md",children:[(0,l.jsx)(d.Text,{size:"sm",c:"dimmed",children:null==j?void 0:j.username}),(0,l.jsx)(x.Button,{variant:"subtle",color:"gray",size:"sm",onClick:()=>{localStorage.removeItem("admin_token"),localStorage.removeItem("admin_user"),v.push("/admin/login/")},children:"로그아웃"})]})]}),(0,l.jsx)(h.Title,{order:1,fw:300,size:"h2",children:n})]}),(0,l.jsx)("main",{children:t})]})})}},96767:(e,t,n)=>{"use strict";n.d(t,{default:()=>F});var l=n(95155),a=n(12115),i=n(86237),s=n(8918),r=n(37621),o=n(73524),c=n(63090),d=n(2369),u=n(67661),p=n(70305),x=n(96778),h=n(41970),m=n(82726),g=n(17998),v=n(67623),j=n(63498),f=n(58380),y=n(14777),b=n(85784),S=n(92364),k=n(89712),w=n(2186);let _=(0,a.createContext)(null);function T(){let e=(0,a.useContext)(_);if(!e)throw Error("useNav must be used within NavProvider");return e}let C=[{id:"short",name:"단편",description:"한 편으로 완결되는 짧은 이야기",unit:"장",unitLabel:"장(章)",listLabel:"장 목록",nextText:"다음 장"},{id:"long",name:"장편",description:"한 권 분량의 완결된 이야기",unit:"장",unitLabel:"장(章)",listLabel:"장 목록",nextText:"다음 장"},{id:"series",name:"연재물",description:"여러 회차로 연재되는 이야기",unit:"화",unitLabel:"회차",listLabel:"회차 목록",nextText:"다음 화"}],z=e=>{var t;return(null==(t=C.find(t=>t.id===e))?void 0:t.unit)||"화"},B=e=>{var t;return(null==(t=C.find(t=>t.id===e))?void 0:t.listLabel)||"목록"},E=[{id:"fantasy",name:"판타지"},{id:"romance",name:"로맨스"},{id:"action",name:"액션"},{id:"thriller",name:"스릴러"},{id:"mystery",name:"미스터리"},{id:"sf",name:"SF"},{id:"horror",name:"호러"},{id:"drama",name:"드라마"},{id:"comedy",name:"코미디"},{id:"slice_of_life",name:"일상"},{id:"historical",name:"역사"},{id:"martial_arts",name:"무협"},{id:"game",name:"게임"},{id:"sports",name:"스포츠"},{id:"music",name:"음악"},{id:"psychological",name:"심리"},{id:"supernatural",name:"초자연"},{id:"adventure",name:"모험"}],L=[{id:"related",name:"연관 작품"},{id:"sequel",name:"후속작"},{id:"prequel",name:"전편"},{id:"spinoff",name:"스핀오프"},{id:"same_universe",name:"같은 세계관"}],G=[{id:"draft",name:"임시저장"},{id:"ongoing",name:"연재중"},{id:"completed",name:"완결"},{id:"hiatus",name:"휴재"}],P=e=>({short:"purple",long:"indigo",series:"cyan"})[e]||"gray";function A(){let{navigate:e}=T(),[t,n]=(0,a.useState)([]),[s,j]=(0,a.useState)(!0),[f,y]=(0,a.useState)(""),[b,S]=(0,a.useState)(null);(0,a.useEffect)(()=>{w()},[]);let w=async()=>{try{j(!0);let e=await r._H.list({include_drafts:!0});n(e.novels||[])}catch(e){y(e instanceof Error?e.message:"소설 목록을 불러오는데 실패했습니다")}finally{j(!1)}},_=async e=>{let l=localStorage.getItem("admin_token");if(l)try{await r._H.delete(e,l),n(t.filter(t=>t.slug!==e)),S(null)}catch(e){y(e instanceof Error?e.message:"삭제에 실패했습니다")}};return s?(0,l.jsx)(i.A,{title:"소설 관리",children:(0,l.jsx)(o.Flex,{justify:"center",align:"center",h:300,children:(0,l.jsx)(c.Loader,{})})}):(0,l.jsx)(i.A,{title:"소설 관리",children:(0,l.jsxs)(d.Stack,{gap:"lg",children:[(0,l.jsxs)(u.Group,{justify:"space-between",align:"center",children:[(0,l.jsxs)(p.Text,{size:"sm",c:"dimmed",children:["총 ",t.length,"개의 소설"]}),(0,l.jsx)(x.Button,{onClick:()=>e({view:"new"}),leftSection:(0,l.jsx)(k.A,{size:16}),size:"sm",children:"새 소설"})]}),f&&(0,l.jsx)(h.Alert,{title:"오류",color:"red",variant:"light",children:f}),0===t.length&&(0,l.jsxs)(m.Paper,{p:"xl",ta:"center",style:{borderTop:"1px solid var(--mantine-color-gray-7)"},children:[(0,l.jsx)(p.Text,{c:"dimmed",mb:"md",children:"아직 소설이 없습니다"}),(0,l.jsx)(x.Button,{variant:"light",onClick:()=>e({view:"new"}),children:"첫 소설 작성하기 →"})]}),(0,l.jsx)(d.Stack,{gap:"md",children:t.map(t=>{var n,a,i,s;return(0,l.jsx)(m.Paper,{p:"md",style:{borderLeft:"4px solid var(--mantine-color-".concat(P(t.novel_type),"-6)")},children:(0,l.jsxs)(d.Stack,{gap:"sm",children:[(0,l.jsxs)(u.Group,{gap:"xs",children:[(0,l.jsx)(g.Badge,{color:P(t.novel_type),variant:"light",children:(n=t.novel_type,(null==(a=C.find(e=>e.id===n))?void 0:a.name)||n)}),(0,l.jsx)(g.Badge,{color:{ongoing:"blue",completed:"green",hiatus:"yellow",draft:"gray"}[t.status]||"gray",variant:"light",children:(i=t.status,(null==(s=G.find(e=>e.id===i))?void 0:s.name)||i)})]}),(0,l.jsxs)(v.Box,{children:[(0,l.jsx)(p.Text,{fw:600,size:"md",mb:"xs",children:t.title}),t.description&&(0,l.jsx)(p.Text,{size:"sm",c:"dimmed",lineClamp:2,children:t.description})]}),t.genres&&t.genres.length>0&&(0,l.jsx)(u.Group,{gap:"xs",children:t.genres.map(e=>{var t;return(0,l.jsx)(g.Badge,{variant:"dot",size:"sm",children:(null==(t=E.find(t=>t.id===e))?void 0:t.name)||e},e)})}),(0,l.jsx)(p.Text,{size:"xs",c:"dimmed",children:new Date(t.created_at).toLocaleDateString("ko-KR")}),(0,l.jsxs)(u.Group,{justify:"flex-end",gap:"xs",mt:"md",children:[(0,l.jsxs)(x.Button,{variant:"light",size:"xs",onClick:()=>e({view:"chapter-new",slug:t.slug}),children:["+ ",z(t.novel_type)]}),(0,l.jsx)(x.Button,{variant:"default",size:"xs",onClick:()=>e({view:"chapters",slug:t.slug}),children:"series"===t.novel_type?"회차 관리":"장 관리"}),(0,l.jsx)(x.Button,{variant:"default",size:"xs",onClick:()=>e({view:"edit",slug:t.slug}),children:"정보 수정"}),b===t.slug?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(x.Button,{variant:"light",color:"red",size:"xs",onClick:()=>_(t.slug),children:"확인"}),(0,l.jsx)(x.Button,{variant:"default",size:"xs",onClick:()=>S(null),children:"취소"})]}):(0,l.jsx)(x.Button,{variant:"subtle",color:"red",size:"xs",onClick:()=>S(t.slug),children:"삭제"})]})]})},t.id)})})]})})}function I(e){let{selected:t,onChange:n,disabled:a}=e;return(0,l.jsx)(u.Group,{gap:"xs",children:E.map(e=>(0,l.jsx)(g.Badge,{variant:t.includes(e.id)?"filled":"light",onClick:()=>{var l;return!a&&(l=e.id,void(t.includes(l)?n(t.filter(e=>e!==l)):n([...t,l])))},style:{cursor:a?"not-allowed":"pointer",opacity:a?.5:1},children:e.name},e.id))})}function H(e){let{novelSlug:t,selected:n,onChange:i,disabled:s}=e,[o,c]=(0,a.useState)([]),[h,g]=(0,a.useState)(""),[v,b]=(0,a.useState)(!1),[S,k]=(0,a.useState)("related");(0,a.useEffect)(()=>{(async()=>{try{var e;let n=await r._H.list({include_drafts:!0});c((null==(e=n.novels)?void 0:e.filter(e=>e.slug!==t))||[])}catch(e){}})()},[t]);let _=o.filter(e=>e.title.toLowerCase().includes(h.toLowerCase())&&!n.some(t=>t.slug===e.slug));return(0,l.jsxs)(d.Stack,{gap:"md",children:[n.length>0&&(0,l.jsx)(d.Stack,{gap:"sm",children:n.map(e=>(0,l.jsxs)(u.Group,{justify:"space-between",p:"sm",style:{backgroundColor:"var(--mantine-color-gray-8)"},children:[(0,l.jsx)(p.Text,{flex:1,size:"sm",children:e.title}),(0,l.jsx)(j.Select,{value:e.relation_type,onChange:t=>{var l;return t&&(l=e.slug,void i(n.map(e=>e.slug===l?{...e,relation_type:t}:e)))},disabled:s,data:L.map(e=>({value:e.id,label:e.name})),size:"xs",searchable:!1,clearable:!1}),(0,l.jsx)(f.ActionIcon,{variant:"subtle",color:"red",onClick:()=>{var t;return t=e.slug,void i(n.filter(e=>e.slug!==t))},disabled:s,size:"sm",children:(0,l.jsx)(w.A,{size:16})})]},e.slug))}),(0,l.jsxs)(d.Stack,{gap:"sm",children:[(0,l.jsxs)(u.Group,{gap:"sm",children:[(0,l.jsx)(y.Input,{placeholder:"연관 작품 검색...",value:h,onChange:e=>{g(e.currentTarget.value),b(!0)},onFocus:()=>b(!0),disabled:s,flex:1}),(0,l.jsx)(j.Select,{value:S,onChange:e=>e&&k(e),disabled:s,data:L.map(e=>({value:e.id,label:e.name})),searchable:!1,clearable:!1,style:{minWidth:150}})]}),v&&_.length>0&&(0,l.jsx)(m.Paper,{p:"xs",style:{maxHeight:300,overflow:"auto",border:"1px solid var(--mantine-color-gray-6)"},children:(0,l.jsx)(d.Stack,{gap:0,children:_.map(e=>(0,l.jsx)(x.Button,{variant:"subtle",onClick:()=>{i([...n,{slug:e.slug,title:e.title,relation_type:S}]),g(""),b(!1)},justify:"flex-start",size:"sm",children:e.title},e.slug))})})]})]})}function N(){let{navigate:e,goBack:t}=T(),[n,s]=(0,a.useState)(!1),[o,c]=(0,a.useState)(""),[v,j]=(0,a.useState)({title:"",description:"",novel_type:"series",genres:[],status:"draft",content:""}),f=async t=>{t.preventDefault(),c(""),s(!0);let n=localStorage.getItem("admin_token");if(!n){c("로그인이 필요합니다"),s(!1);return}try{let t={title:v.title,description:v.description,novel_type:v.novel_type,genres:v.genres,status:v.status},l=await r._H.create(t,n);e({view:"chapter-new",slug:l.slug})}catch(e){c(e instanceof Error?e.message:"소설 생성에 실패했습니다")}finally{s(!1)}};return(0,l.jsx)(i.A,{title:"새 소설",onBack:t,backLabel:"← 소설 목록",children:(0,l.jsx)("form",{onSubmit:f,children:(0,l.jsxs)(d.Stack,{gap:"lg",maw:600,children:[o&&(0,l.jsx)(h.Alert,{title:"오류",color:"red",variant:"light",children:o}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{component:"label",fw:500,size:"sm",children:"제목 *"}),(0,l.jsx)(y.Input,{value:v.title,onChange:e=>j({...v,title:e.currentTarget.value}),placeholder:"소설 제목을 입력하세요",required:!0,disabled:n}),(0,l.jsx)(p.Text,{size:"xs",c:"dimmed",children:"URL 슬러그는 UUID 기반으로 자동 생성됩니다"})]}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{fw:500,size:"sm",children:"소설 유형 *"}),(0,l.jsx)(b.Grid,{gutter:"md",children:C.map(e=>(0,l.jsx)(b.Grid.Col,{span:{base:12,sm:4},children:(0,l.jsxs)(m.Paper,{p:"md",onClick:()=>j({...v,novel_type:e.id}),style:{cursor:"pointer",border:v.novel_type===e.id?"2px solid var(--mantine-primary-color)":"2px solid var(--mantine-color-gray-6)",transition:"border-color 0.2s"},children:[(0,l.jsx)(p.Text,{fw:600,size:"sm",children:e.name}),(0,l.jsx)(p.Text,{size:"xs",c:"dimmed",mt:"xs",children:e.description})]})},e.id))})]}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{fw:500,size:"sm",children:"장르"}),(0,l.jsx)(I,{selected:v.genres,onChange:e=>j({...v,genres:e}),disabled:n})]}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{component:"label",fw:500,size:"sm",children:"설명"}),(0,l.jsx)(S.Textarea,{value:v.description,onChange:e=>j({...v,description:e.currentTarget.value}),rows:4,placeholder:"소설에 대한 간단한 설명을 입력하세요",disabled:n})]}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{fw:500,size:"sm",children:"상태"}),(0,l.jsx)(u.Group,{gap:"xs",children:G.map(e=>(0,l.jsx)(g.Badge,{variant:v.status===e.id?"filled":"light",onClick:()=>j({...v,status:e.id}),style:{cursor:n?"not-allowed":"pointer",opacity:n?.5:1},children:e.name},e.id))})]}),(0,l.jsxs)(d.Stack,{gap:"md",pt:"md",style:{borderTop:"1px solid var(--mantine-color-gray-7)"},children:[(0,l.jsx)(p.Text,{size:"sm",c:"dimmed",children:"short"===v.novel_type?"소설 정보를 저장하면 본문 작성 페이지로 이동합니다.":"long"===v.novel_type?"소설 정보를 저장하면 첫 번째 장(章) 작성 페이지로 이동합니다.":"소설 정보를 저장하면 1화 작성 페이지로 이동합니다."}),(0,l.jsxs)(u.Group,{justify:"flex-start",children:[(0,l.jsx)(x.Button,{type:"submit",disabled:n||!v.title,loading:n,children:"short"===v.novel_type?"저장 후 본문 작성 →":"long"===v.novel_type?"저장 후 1장 작성 →":"저장 후 1화 작성 →"}),(0,l.jsx)(x.Button,{type:"button",variant:"default",onClick:t,disabled:n,children:"취소"})]})]})]})})})}function D(e){let{slug:t}=e,{navigate:n,goBack:s}=T(),[v,j]=(0,a.useState)(!1),[f,k]=(0,a.useState)(!0),[w,_]=(0,a.useState)(""),[z,B]=(0,a.useState)({title:"",description:"",novel_type:"series",genres:[],status:"draft"}),[E,L]=(0,a.useState)([]),[P,A]=(0,a.useState)([]),N=(0,a.useCallback)(async()=>{try{var e;let n=await r._H.getBySlug(t);B({title:n.title,description:n.description||"",novel_type:n.novel_type||"series",genres:n.genres||[],status:n.status});let l=(null==(e=n.related_novels)?void 0:e.map(e=>({slug:e.slug,title:e.title,relation_type:e.relation_type})))||[];L(l),A(l)}catch(e){_(e instanceof Error?e.message:"소설을 불러오는데 실패했습니다")}finally{k(!1)}},[t]);(0,a.useEffect)(()=>{N()},[N]);let D=async e=>{e.preventDefault(),_(""),j(!0);let l=localStorage.getItem("admin_token");if(!l){_("로그인이 필요합니다"),j(!1);return}try{let e=P.filter(e=>!E.some(t=>t.slug===e.slug)),a=E.filter(e=>{let t=P.find(t=>t.slug===e.slug);return!t||t.relation_type!==e.relation_type}),i={title:z.title,description:z.description,novel_type:z.novel_type,genres:z.genres,status:z.status};e.length>0&&(i.remove_related_novels=e.map(e=>e.slug)),a.length>0&&(i.related_novels=a.map(e=>({related_novel_slug:e.slug,relation_type:e.relation_type}))),await r._H.update(t,i,l),n({view:"list"})}catch(e){_(e instanceof Error?e.message:"소설 수정에 실패했습니다")}finally{j(!1)}};return f?(0,l.jsx)(i.A,{title:"소설 편집",onBack:s,backLabel:"← 소설 목록",children:(0,l.jsx)(o.Flex,{justify:"center",align:"center",h:300,children:(0,l.jsx)(c.Loader,{})})}):(0,l.jsx)(i.A,{title:"소설 편집",onBack:s,backLabel:"← 소설 목록",children:(0,l.jsx)("form",{onSubmit:D,children:(0,l.jsxs)(d.Stack,{gap:"lg",maw:600,children:[w&&(0,l.jsx)(h.Alert,{title:"오류",color:"red",variant:"light",children:w}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{component:"label",fw:500,size:"sm",children:"제목 *"}),(0,l.jsx)(y.Input,{value:z.title,onChange:e=>B({...z,title:e.currentTarget.value}),placeholder:"소설 제목",required:!0,disabled:v})]}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{fw:500,size:"sm",children:"소설 유형 *"}),(0,l.jsx)(b.Grid,{gutter:"md",children:C.map(e=>(0,l.jsx)(b.Grid.Col,{span:{base:12,sm:4},children:(0,l.jsxs)(m.Paper,{p:"md",onClick:()=>B({...z,novel_type:e.id}),style:{cursor:"pointer",border:z.novel_type===e.id?"2px solid var(--mantine-primary-color)":"2px solid var(--mantine-color-gray-6)",transition:"border-color 0.2s"},children:[(0,l.jsx)(p.Text,{fw:600,size:"sm",children:e.name}),(0,l.jsx)(p.Text,{size:"xs",c:"dimmed",mt:"xs",children:e.description})]})},e.id))})]}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{fw:500,size:"sm",children:"장르"}),(0,l.jsx)(I,{selected:z.genres,onChange:e=>B({...z,genres:e}),disabled:v})]}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{component:"label",fw:500,size:"sm",children:"설명"}),(0,l.jsx)(S.Textarea,{value:z.description,onChange:e=>B({...z,description:e.currentTarget.value}),rows:4,placeholder:"소설에 대한 설명",disabled:v})]}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{fw:500,size:"sm",children:"상태"}),(0,l.jsx)(u.Group,{gap:"xs",children:G.map(e=>(0,l.jsx)(g.Badge,{variant:z.status===e.id?"filled":"light",onClick:()=>B({...z,status:e.id}),style:{cursor:v?"not-allowed":"pointer",opacity:v?.5:1},children:e.name},e.id))})]}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{fw:500,size:"sm",children:"연관 작품"}),(0,l.jsx)(H,{novelSlug:t,selected:E,onChange:L,disabled:v})]}),(0,l.jsxs)(u.Group,{justify:"flex-start",pt:"md",style:{borderTop:"1px solid var(--mantine-color-gray-7)"},children:[(0,l.jsx)(x.Button,{type:"submit",disabled:v||!z.title,loading:v,children:"저장"}),(0,l.jsx)(x.Button,{type:"button",variant:"default",onClick:s,disabled:v,children:"취소"})]})]})})})}function O(e){let{slug:t}=e,{navigate:n,goBack:s}=T(),[g,j]=(0,a.useState)(null),[f,y]=(0,a.useState)([]),[b,S]=(0,a.useState)(!0),[w,_]=(0,a.useState)(""),[C,E]=(0,a.useState)(null),L=(0,a.useCallback)(async()=>{try{S(!0);let[e,n]=await Promise.all([r._H.getBySlug(t),r._H.getChapters(t)]);j(e),y(n.chapters||[])}catch(e){_(e instanceof Error?e.message:"데이터를 불러오는데 실패했습니다")}finally{S(!1)}},[t]);(0,a.useEffect)(()=>{L()},[L]);let G=async e=>{let n=localStorage.getItem("admin_token");if(n)try{await r._H.deleteChapter(t,e,n),y(f.filter(t=>t.chapter_number!==e)),E(null)}catch(e){_(e instanceof Error?e.message:"장을 삭제하는데 실패했습니다")}};if(b)return(0,l.jsx)(i.A,{title:"".concat(null==g?void 0:g.title," - ").concat(B((null==g?void 0:g.novel_type)||"series")),onBack:s,backLabel:"← 돌아가기",children:(0,l.jsx)(o.Flex,{justify:"center",align:"center",h:300,children:(0,l.jsx)(c.Loader,{})})});let P=z((null==g?void 0:g.novel_type)||"series"),A=(null==g||g.novel_type,"".concat(P," 목록"));return(0,l.jsx)(i.A,{title:"".concat(null==g?void 0:g.title," - ").concat(A),onBack:s,backLabel:"← 돌아가기",children:(0,l.jsxs)(d.Stack,{gap:"lg",children:[w&&(0,l.jsx)(h.Alert,{title:"오류",color:"red",variant:"light",children:w}),(0,l.jsxs)(u.Group,{justify:"space-between",children:[(0,l.jsxs)(p.Text,{size:"sm",c:"dimmed",children:["총 ",f.length,"개의 ",P]}),(0,l.jsxs)(x.Button,{onClick:()=>n({view:"chapter-new",slug:t}),leftSection:(0,l.jsx)(k.A,{size:16}),size:"sm",children:["새 ",P]})]}),0===f.length?(0,l.jsxs)(m.Paper,{p:"xl",ta:"center",children:[(0,l.jsxs)(p.Text,{c:"dimmed",mb:"md",children:["아직 ",P,"이 없습니다"]}),(0,l.jsxs)(x.Button,{variant:"light",onClick:()=>n({view:"chapter-new",slug:t}),children:["첫 ",P," 작성하기 →"]})]}):(0,l.jsx)(d.Stack,{gap:"md",children:f.map(e=>(0,l.jsx)(m.Paper,{p:"md",children:(0,l.jsxs)(u.Group,{justify:"space-between",align:"flex-start",children:[(0,l.jsxs)(v.Box,{flex:1,children:[(0,l.jsxs)(p.Text,{fw:600,size:"md",children:[P," ",e.chapter_number,": ",e.title]}),(0,l.jsx)(p.Text,{size:"xs",c:"dimmed",mt:"xs",children:new Date(e.created_at).toLocaleDateString("ko-KR")})]}),(0,l.jsxs)(u.Group,{gap:"xs",children:[(0,l.jsx)(x.Button,{variant:"default",size:"xs",onClick:()=>n({view:"chapter-edit",slug:t,chapterNumber:e.chapter_number}),children:"수정"}),C===e.chapter_number?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(x.Button,{variant:"light",color:"red",size:"xs",onClick:()=>G(e.chapter_number),children:"확인"}),(0,l.jsx)(x.Button,{variant:"default",size:"xs",onClick:()=>E(null),children:"취소"})]}):(0,l.jsx)(x.Button,{variant:"subtle",color:"red",size:"xs",onClick:()=>E(e.chapter_number),children:"삭제"})]})]})},e.id))})]})})}function U(e){var t,n,m,g;let{slug:v}=e,{navigate:j,goBack:f}=T(),[b,S]=(0,a.useState)(null),[k,w]=(0,a.useState)(!0),[_,E]=(0,a.useState)(""),[L,G]=(0,a.useState)(""),[P,A]=(0,a.useState)({number:1,title:"",content:""}),[I,H]=(0,a.useState)(!1),N=(0,a.useCallback)(async()=>{try{let e=await r._H.getBySlug(v),t=await r._H.getChapters(v);S(e);let n=t.chapters||[],l=Math.max(...n.map(e=>e.chapter_number),0);A(e=>({...e,number:l+1}))}catch(e){E(e instanceof Error?e.message:"소설 정보를 불러오는데 실패했습니다")}finally{w(!1)}},[v]);(0,a.useEffect)(()=>{N()},[N]);let D=async e=>{e.preventDefault(),E(""),H(!0);let t=localStorage.getItem("admin_token");if(!t){E("로그인이 필요합니다"),H(!1);return}try{await r._H.createChapter(v,{chapter_number:P.number,title:P.title,content:P.content},t);let e=z((null==b?void 0:b.novel_type)||"series");G("".concat(e,"이 저장되었습니다")),setTimeout(()=>{j({view:"chapter-new",slug:v})},1500)}catch(e){E(e instanceof Error?e.message:"저장에 실패했습니다")}finally{H(!1)}};if(k)return(0,l.jsx)(i.A,{title:"새 장",onBack:f,backLabel:"← 돌아가기",children:(0,l.jsx)(o.Flex,{justify:"center",align:"center",h:300,children:(0,l.jsx)(c.Loader,{})})});let O=(t=(null==b?void 0:b.novel_type)||"series",(null==(n=C.find(e=>e.id===t))?void 0:n.unitLabel)||"회차"),U=B((null==b?void 0:b.novel_type)||"series"),R=(m=(null==b?void 0:b.novel_type)||"series",(null==(g=C.find(e=>e.id===m))?void 0:g.nextText)||"다음"),F=(null==b?void 0:b.novel_type)==="series"?"새로운 회차":(null==b?void 0:b.novel_type)==="long"?"새로운 장(章)":"새로운 본문";return(0,l.jsx)(i.A,{title:F,onBack:f,backLabel:"← 돌아가기",children:(0,l.jsx)("form",{onSubmit:D,children:(0,l.jsxs)(d.Stack,{gap:"lg",maw:900,children:[_&&(0,l.jsx)(h.Alert,{title:"오류",color:"red",variant:"light",children:_}),L&&(0,l.jsx)(h.Alert,{title:"성공",color:"green",variant:"light",children:L}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{component:"label",fw:500,size:"sm",children:O}),(0,l.jsx)(y.Input,{type:"number",value:P.number,onChange:e=>A({...P,number:parseInt(e.currentTarget.value)||1}),min:1,disabled:I})]}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{component:"label",fw:500,size:"sm",children:"제목 *"}),(0,l.jsx)(y.Input,{value:P.title,onChange:e=>A({...P,title:e.currentTarget.value}),placeholder:"장의 제목을 입력하세요",required:!0,disabled:I})]}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{component:"label",fw:500,size:"sm",children:"내용 *"}),(0,l.jsx)(s.A,{value:P.content,onChange:e=>A({...P,content:e})})]}),(0,l.jsxs)(u.Group,{justify:"flex-start",pt:"md",style:{borderTop:"1px solid var(--mantine-color-gray-7)"},children:[(0,l.jsxs)(x.Button,{type:"submit",disabled:I||!P.title||!P.content,loading:I,children:["저장 후 ",R," 작성 →"]}),(0,l.jsxs)(x.Button,{type:"button",variant:"default",onClick:()=>j({view:"chapters",slug:v}),disabled:I,children:[U,"로 돌아가기"]}),(0,l.jsx)(x.Button,{type:"button",variant:"default",onClick:f,disabled:I,children:"취소"})]})]})})})}function R(e){let{slug:t,chapterNumber:n}=e,{navigate:m,goBack:g}=T(),[,v]=(0,a.useState)(null),[j,f]=(0,a.useState)(!1),[b,S]=(0,a.useState)(!0),[k,w]=(0,a.useState)(""),[_,C]=(0,a.useState)({number:n,title:"",content:""}),z=(0,a.useCallback)(async()=>{try{let[e,l]=await Promise.all([r._H.getBySlug(t),r._H.getChapter(t,n)]);v(e);let a=l.chapter;C({number:a.chapter_number,title:a.title,content:a.content})}catch(e){w(e instanceof Error?e.message:"데이터를 불러오는데 실패했습니다")}finally{S(!1)}},[t,n]);(0,a.useEffect)(()=>{z()},[z]);let B=async e=>{e.preventDefault(),w(""),f(!0);let l=localStorage.getItem("admin_token");if(!l){w("로그인이 필요합니다"),f(!1);return}try{await r._H.updateChapter(t,n,{title:_.title,content:_.content},l),m({view:"chapters",slug:t})}catch(e){w(e instanceof Error?e.message:"저장에 실패했습니다")}finally{f(!1)}};return b?(0,l.jsx)(i.A,{title:"장 편집",onBack:g,backLabel:"← 돌아가기",children:(0,l.jsx)(o.Flex,{justify:"center",align:"center",h:300,children:(0,l.jsx)(c.Loader,{})})}):(0,l.jsx)(i.A,{title:"장 편집",onBack:g,backLabel:"← 돌아가기",children:(0,l.jsx)("form",{onSubmit:B,children:(0,l.jsxs)(d.Stack,{gap:"lg",maw:900,children:[k&&(0,l.jsx)(h.Alert,{title:"오류",color:"red",variant:"light",children:k}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{component:"label",fw:500,size:"sm",children:"제목 *"}),(0,l.jsx)(y.Input,{value:_.title,onChange:e=>C({..._,title:e.currentTarget.value}),placeholder:"장의 제목",required:!0,disabled:j})]}),(0,l.jsxs)(d.Stack,{gap:"xs",children:[(0,l.jsx)(p.Text,{component:"label",fw:500,size:"sm",children:"내용 *"}),(0,l.jsx)(s.A,{value:_.content,onChange:e=>C({..._,content:e})})]}),(0,l.jsxs)(u.Group,{justify:"flex-start",pt:"md",style:{borderTop:"1px solid var(--mantine-color-gray-7)"},children:[(0,l.jsx)(x.Button,{type:"submit",disabled:j||!_.title||!_.content,loading:j,children:"저장"}),(0,l.jsx)(x.Button,{type:"button",variant:"default",onClick:()=>m({view:"chapters",slug:t}),disabled:j,children:"목록으로 돌아가기"}),(0,l.jsx)(x.Button,{type:"button",variant:"default",onClick:g,disabled:j,children:"취소"})]})]})})})}function F(){let[e,t]=(0,a.useState)({view:"list"}),[,n]=(0,a.useState)([]),i=(0,a.useCallback)(l=>{n(t=>[...t,e]),t(l)},[e]),s=(0,a.useCallback)(()=>{n(e=>{let n=[...e],l=n.pop();return l&&t(l),n})},[]);return(0,l.jsx)(_.Provider,{value:{navState:e,navigate:i,goBack:s},children:(()=>{let{view:t,slug:n,chapterNumber:a}=e;switch(t){case"list":return(0,l.jsx)(A,{});case"new":return(0,l.jsx)(N,{});case"edit":return n?(0,l.jsx)(D,{slug:n}):null;case"chapters":return n?(0,l.jsx)(O,{slug:n}):null;case"chapter-new":return n?(0,l.jsx)(U,{slug:n}):null;case"chapter-edit":return n&&a?(0,l.jsx)(R,{slug:n,chapterNumber:a}):null;default:return null}})()})}}},e=>{e.O(0,[4092,2545,641,6778,4256,5373,8098,2619,6478,9748,9308,8441,1255,7358],()=>e(e.s=10691)),_N_E=e.O()}]);